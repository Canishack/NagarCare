<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NagarCare - Contractor Directory</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: #f5fff5;
      color: #333;
    }

    header {
      background-color: #2e7d32;
      color: white;
      padding: 20px 40px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 2.5rem;
    }

    .container {
      padding: 40px;
      max-width: 1000px;
      margin: auto;
    }

    .search-filter {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    select, input, button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      margin-bottom: 10px;
    }

    select, input {
      width: 48%;
    }

    button {
      background-color: #2e7d32;
      color: white;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    th, td {
      padding: 12px 20px;
      border-bottom: 1px solid #e0e0e0;
      text-align: left;
    }

    th {
      background-color: #a5d6a7;
      color: #1b5e20;
    }

    tr:hover {
      background-color: #e8f5e9;
    }

    .location-box {
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      select, input {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>NagarCare Contractor Directory</h1>
    <p>Find local contractors</p>
  </header>

  <div class="container">
    <div class="location-box">
      <button onclick="fetchLocation()">Find Contractors Near Me</button>
      <input type="text" id="location" placeholder="Location will appear here..." readonly />
      <div id="result"></div>
    </div>

    <div class="search-filter">
      <input type="text" id="searchName" placeholder="Search contractor by name...">
      <select id="areaFilter">
        <option value="All">All Areas</option>
        <option value="Kanpur">Kanpur</option>
        <option value="Lucknow">Lucknow</option>
        <option value="Delhi">Delhi</option>
        <option value="Jaipur">Jaipur</option>
        <option value="Agra">Agra</option>
      </select>
    </div>

    <table id="contractorTable">
      <thead>
        <tr>
          <th>Contractor Name</th>
          <th>Contact Number</th>
          <th>Area</th>
        </tr>
      </thead>
      <tbody>
        <!-- Empty initially -->
      </tbody>
    </table>
  </div>

  <script>
    const contractors = [
      { name: "Ankit Verma", phone: "9811111111", area: "Kanpur" },
      { name: "Rajeev Shukla", phone: "9811111112", area: "Kanpur" },
      { name: "Neeraj Gupta", phone: "9811111113", area: "Kanpur" },
      { name: "Manish Tiwari", phone: "9811111114", area: "Kanpur" },
      { name: "Kiran Yadav", phone: "9811111115", area: "Kanpur" },
      { name: "Shivam Singh", phone: "9822222221", area: "Lucknow" },
      { name: "Pooja Srivastava", phone: "9822222222", area: "Lucknow" },
      { name: "Aman Pandey", phone: "9822222223", area: "Lucknow" },
      { name: "Ritika Sharma", phone: "9822222224", area: "Lucknow" },
      { name: "Vikas Dubey", phone: "9822222225", area: "Lucknow" },
      { name: "Rohit Malhotra", phone: "9833333331", area: "Delhi" },
      { name: "Meena Kapoor", phone: "9833333332", area: "Delhi" },
      { name: "Harsh Bhalla", phone: "9833333333", area: "Delhi" },
      { name: "Divya Arora", phone: "9833333334", area: "Delhi" },
      { name: "Anjali Mehra", phone: "9833333335", area: "Delhi" },
      { name: "Suresh Rathore", phone: "9844444441", area: "Jaipur" },
      { name: "Mahesh Choudhary", phone: "9844444442", area: "Jaipur" },
      { name: "Kavita Singh", phone: "9844444443", area: "Jaipur" },
      { name: "Ramesh Yadav", phone: "9844444444", area: "Jaipur" },
      { name: "Sneha Jain", phone: "9844444445", area: "Jaipur" },
      { name: "Deepak Gupta", phone: "9855555551", area: "Agra" },
      { name: "Sonal Agrawal", phone: "9855555552", area: "Agra" },
      { name: "Vivek Bansal", phone: "9855555553", area: "Agra" },
      { name: "Rekha Sharma", phone: "9855555554", area: "Agra" },
      { name: "Yash Chauhan", phone: "9855555555", area: "Agra" }
    ];

    const searchInput = document.getElementById('searchName');
    const areaFilter = document.getElementById('areaFilter');
    const tbody = document.querySelector('#contractorTable tbody');

    function filterTable() {
      const nameQuery = searchInput.value.toLowerCase();
      const selectedArea = areaFilter.value;

      tbody.innerHTML = '';

      if (selectedArea === 'All') return;

      const filtered = contractors.filter(c =>
        c.name.toLowerCase().includes(nameQuery) &&
        c.area === selectedArea
      );

      tbody.innerHTML = filtered.map(c => `
        <tr>
          <td>${c.name}</td>
          <td>${c.phone}</td>
          <td>${c.area}</td>
        </tr>
      `).join('');
    }

    areaFilter.addEventListener('change', () => {
      searchInput.value = '';
      filterTable();
    });

    searchInput.addEventListener('input', filterTable);

    function fetchLocation() {
      const locationInput = document.getElementById("location");
      const resultDiv = document.getElementById("result");
      tbody.innerHTML = '';
      locationInput.value = "Fetching your location...";
      resultDiv.innerHTML = "";

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async function (position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          try {
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
            const data = await response.json();
            const area = data.address.suburb || data.address.city || data.address.town || "";

            locationInput.value = area || "Area not found";

            const matched = contractors.filter(c => area.toLowerCase().includes(c.area.toLowerCase()));
            if (matched.length) {
              resultDiv.innerHTML = `<strong>Contractors in ${area}</strong>`;
              tbody.innerHTML = matched.map(c => `
                <tr>
                  <td>${c.name}</td>
                  <td>${c.phone}</td>
                  <td>${c.area}</td>
                </tr>`).join('');
            } else {
              resultDiv.innerHTML = "<p>No contractor found for this area.</p>";
            }

          } catch (err) {
            locationInput.value = "Error fetching location";
          }
        }, function (error) {
          locationInput.value = "Permission denied or error";
        });
      } else {
        locationInput.value = "Geolocation not supported";
      }
    }
  </script>
</body>

</html>
